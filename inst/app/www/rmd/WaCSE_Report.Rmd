---
title: "Washington Climate Smart Estimator Report"
date: "**`r tools::toTitleCase(params$project)`** report generated by **`r tools::toTitleCase(params$name)`** on `r format(Sys.time(), ' %B %d, %Y')`"
geometry: "left=1cm,right=1cm,top=2cm,bottom=2cm"
mainfont: Arial
output: 
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{tabu} # to prevent latex compilation error
  - \usepackage{booktabs} # to prevent latex compilation error
  - \usepackage{fancyhdr} # for header and footers
  - \pagestyle{fancy}
  - \fancyhf{}
  - \lhead{WaCSE reported generated on `r Sys.Date()`}
  - \rhead{`r paste(tools::toTitleCase(params$name), tools::toTitleCase(params$project))`}
  - \cfoot{\thepage}
  - \usepackage{titlesec} # reduce space between header and text
  - \titlespacing{\section}{0pt}{10pt plus 1pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \titlespacing{\subsection}{0pt}{10pt plus 1pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \titlespacing{\subsubsection}{0pt}{10pt plus 1pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \usepackage{titling} #for droptitle to reduce excessive white space before title
  - \setlength{\droptitle}{-1.1in}
  - \usepackage{float} # for holding position of tables
classoption: landscape
urlcolor: blue
params: 
  name: NA
  project: NA
  table: NA
  summary: NA
  plot: NA
---

```{r setup, include = FALSE, echo=FALSE, fig.pos = "H"}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
library(kableExtra)
library(dplyr)
library(ggplot2)
```

# About WaCSE

### Who and what is WaCSE for? 

The [Washington State Department of Agriculture](https://agr.wa.gov/departments/land-and-water/natural-resources) developed WaCSE for the Washington State Conservation Commission to use in the [Sustainable Farms and Fields](https://www.scc.wa.gov/sff) (SFF) program. Intended users are the Conservation Commission, conservation districts, growers, and anyone interested in identifying agricultural conservation practices to reduce greenhouse gas (GHG) emissions. This user-friendly, interactive web application facilitates comparing GHG emission reduction potentials from different conservation practices across Washingtonâ€™s diverse counties.

### Where do the potential GHG emission reduction values come from?  

Values were determined by the United States Department of Agriculture's Natural Resources Conservation Service (NRCS). NRCS reviewed field studies and applied a sample-based metamodeling approach to calculate potential GHG emission reduction coefficients. These values are derived from county-rectified major land resource areas (Swan et al. 2020). 

NRCS and Colorado State University developed two tools to estimate impacts on GHG and soil carbon from conservation practices.

- [**COMET-Farm**](http://comet-farm.com/) is a field-specific tool that requires more detailed information such as parcel, management history to define a system specific baseline, and intended conservation practices.   

- [**COMET-Planner**](http://comet-planner.com/) is a simplified tool that evaluates GHG emission reductions by county, conservation practice practice, and acreage based on a fixed baseline management scenario.

### How does WaCSE differ from COMET-Farm and COMET-Planner?

WaCSE uses the COMET-Planner dataset but presents the GHG emission reductions data in a way that allows comparison between **multiple counties at one time**. The data can be visualized in tables and bar graphs. Users can also easily download the tables, bar graphs, and a PDF report of all outputs from their estimate.

### What do negative values mean?  

Negative values indicate a loss of carbon or increased emissions of GHG (Swan et al. 2020).   

### Where can I find more information about the NRCS conservation practices? 

Technical guides for NRCS conservation practices standards (CPS) are found [here](https://www.nrcs.usda.gov/wps/portal/nrcs/main/national/technical/cp/).

### Reference

Amy Swan, Mark Easter, Adam Chambers, Kevin Brown, Stephen A. Williams, Jeff Creque, John Wick, Keith Paustian. 2020. COMET-Planner Dataset, Version 2.1, Build 1, and COMET-Planner Report: Carbon and Greenhouse Gas Evaluation for NRCS Conservation Practice Planning. A Companion report to [COMET-Planner](http://www.comet-planner.com). [COMET-Planner_Report_Final.pdf](http://bfuels.nrel.colostate.edu/beta/COMET-Planner_Report_Final.pdf). 

#  Definitions

- **Carbon dioxide equivalent (CO2eq)** is a metric measure used to compare emission impacts from various greenhouse gases based on their relative radiative forcing effect over a specified period of time.

- **Total greenhouse gases (GHG)** are the sum of CO2eq emissions from carbon dioxide, methane, and nitrous oxide from field emissions (including those associated with soils and woody biomass). Off-site emissions (i.e. transportation) are not included.

- **Emission reduction coefficients (ERC)** were calculated using a sample-based approach and model runs in <a href="http://comet-farm.com/" target="_blank"> COMET-Farm</a>, which uses USDA greenhouse gas inventory methods. More information on quantification methods can be found in the <a href="https://planner-prod2-dot-comet-201514.appspot.com/static/media/COMET-Planner_Report_Final.41c0b5e0.pdf/" target="_blank"> COMET-Planner Report</a>.

# Tables

```{r table}
options(knitr.kable.NA = "Not estimated")

df <- janitor::adorn_totals(params$table)

kbl_all <- kbl(df,
    col.names = c("MLRA",
                  "County",
                  "Class",
                  "Practice",
                  "Implementation",
                  "Acres",
                  "Carbon Dioxide",
                  "Nitrous Oxide",
                  "Methane",
                  "Total GHG"
                  ),
    caption = "Approximate Greenhouse Gas (GHG) Emission Reductions",
    align = "lllllrrrrr",
    format.args = list(big.mark = ","),
    escape = FALSE,
    booktabs = TRUE) %>%
  add_header_above(c(" " = 6, "(Metric tonnes CO2eq per year)" = 4), italic = TRUE) %>% 
  kable_styling(full_width = TRUE,
                latex_options = "HOLD_position") %>%
  row_spec(row = 0, bold = TRUE) %>%
  column_spec(column = c(1:2), width = "0.8in") %>%
  column_spec(column = c(3:5), width = "1in") %>%
  column_spec(column = c(6:10), width = "0.8in") %>% 
  collapse_rows(columns = 1) %>% 
  row_spec(dim(df)[1], bold = TRUE)

kbl_all
```

```{r summary}
summary_df <- janitor::adorn_totals(params$summary)

kbl_summary <- kbl(summary_df,
    col.names = c("MLRA",
                  "County",
                  "Unique Practice Implementations",
                  "Total Acres",
                  "Total GHG (MT CO2eq/yr)"
                  ),
    caption = "Summary of Total Greenhouse Gas (GHG) Emission Reductions by County",
    align = "llrrr",
    format.args = list(big.mark = ","),
    escape = FALSE,
    booktabs = TRUE) %>%
  kable_styling(latex_options = "HOLD_position") %>% 
  row_spec(row = 0, bold = TRUE) %>%
  column_spec(column = c(1,3,5), width = "1.4in") %>% 
  column_spec(column = c(2,4), width = "0.8in") %>%
  collapse_rows(columns = 1) %>% 
  row_spec(dim(summary_df)[1], bold = TRUE)

kbl_summary
```

# Bar Graph

```{r plot, fig.align = "center", fig.height = 6, fig.width = 10, dpi = 300}

params$plot

```

# Greenhouse Gas Equivalencies

The values shown here are your total estimated esmissions reductions converted into terms you are more likely to be familiar with. Assumptions and equations used to calculate these values are provided in the Environmental Protection Agency's [Greenhouse Gases Equivalencies Calculator](https://www.epa.gov/energy/greenhouse-gases-equivalencies-calculator-calculations-and-references). 

**Will insert total GHG CO2eq and valueBoxes or a table with the equivalencies here**
