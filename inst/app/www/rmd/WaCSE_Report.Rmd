---
title: "Washington Climate Smart Estimator Report"
date: "**`r tools::toTitleCase(params$project)`** report generated by **`r tools::toTitleCase(params$name)`** on `r format(Sys.time(), ' %B %d, %Y')`"
geometry: "left=1cm,right=1cm,top=2cm,bottom=2cm"
mainfont: Arial
fontsize: 10pt
output: 
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{tabu} # to prevent latex compilation error
  - \usepackage{booktabs} # to prevent latex compilation error
  - \usepackage{fancyhdr} # for header and footers
  - \pagestyle{fancy}
  - \fancyhf{}
  - \lhead{WaCSE report generated on `r Sys.Date()`}
  - \rhead{`r paste(tools::toTitleCase(params$name), tools::toTitleCase(params$project))`}
  - \cfoot{\thepage}
  - \usepackage{titlesec} # reduce space between header and text
  - \titlespacing{\section}{0pt}{10pt plus 1pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \titlespacing{\subsection}{0pt}{10pt plus 1pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \titlespacing{\subsubsection}{0pt}{10pt plus 1pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \usepackage{titling} #for droptitle to reduce excessive white space before title
  - \setlength{\droptitle}{-1.1in}
  - \usepackage{float} # for holding position of tables
  - \usepackage[justification=raggedright,labelfont=bf,singlelinecheck=false]{caption} # left align table caption
classoption: landscape
urlcolor: blue
params: 
  name: NA
  project: NA
  data: NA
  summary: NA
  plot: NA
---

```{r setup, include = FALSE, echo = FALSE}

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, tidy = TRUE) 
library(knitr)
library(kableExtra)
library(dplyr)
```

<!-- {.unlisted .unnumbered} keeps the headings from appearing in the pdf bookmarks (which have incorrect indices and hierarchy) -->

# About WaCSE {.unlisted .unnumbered}

### Who and what is WaCSE for? {.unlisted .unnumbered}

The [Washington State Department of Agriculture](https://agr.wa.gov/departments/land-and-water/natural-resources) developed WaCSE for the Washington State Conservation Commission to use in the [Sustainable Farms and Fields](https://www.scc.wa.gov/sff) (SFF) program. Intended users are the Conservation Commission, conservation districts, growers, and anyone interested in reducing agricultural greenhouse gas (GHG) emissions. This interactive tool estimates the reduction of GHG emissions from different conservation practices across Washington’s diverse counties.

### Where do the potential GHG emission reduction values come from? {.unlisted .unnumbered}

Values were determined by the United States Department of Agriculture’s Natural Resources Conservation Service (NRCS). NRCS reviewed field studies and applied a sample-based metamodeling approach to calculate potential GHG emission reduction coefficients. These values are derived from county-rectified major land resource areas (Swan et al. 2020).

NRCS and Colorado State University developed two tools to estimate impacts on GHG and soil carbon from conservation practices.

- [**COMET-Farm**](http://comet-farm.com/) is a field-specific tool that requires detailed management and parcel history to estimate the impact of conservation practices.  

- [**COMET-Planner**](http://comet-planner.com/) is a simplified tool that evaluates GHG emission reductions by county rather than by a specific field with specific management history. It provides a more generalized, less accurate GHG reduction estimate, but is easier to use.

### How does WaCSE differ from COMET-Farm and COMET-Planner? {.unlisted .unnumbered}

WaCSE uses the COMET-Planner dataset and provides identical estimates. With WaCSE, however, data can be compared between multiple counties and multiple practices at once. WaCSE provides data in tables and bar graphs that can easily be download in spreadsheets and PDFs. WaCSE also helps the user understand their GHG reduction estimate by providing a calculator to convert the emissions data into equivalents from home energy use, consuming gasoline, charging smartphones, and more!

### What do negative values mean? {.unlisted .unnumbered}

Negative values indicate a loss of carbon or increased emissions of GHG (Swan et al. 2020).   

### Where can I find more information about the NRCS conservation practices? {.unlisted .unnumbered}

For technical guides, review the [NRCS conservation practices standards (CPS)](https://www.nrcs.usda.gov/wps/portal/nrcs/main/national/technical/cp/).

### Reference {.unlisted .unnumbered}

Amy Swan, Mark Easter, Adam Chambers, Kevin Brown, Stephen A. Williams, Jeff Creque, John Wick, Keith Paustian. 2020. COMET-Planner Dataset, Version 2.1, Build 1, and COMET-Planner Report: Carbon and Greenhouse Gas Evaluation for NRCS Conservation Practice Planning. A Companion report to [COMET-Planner](http://www.comet-planner.com). [http://bfuels.nrel.colostate.edu/beta/COMET-Planner_Report_Final.pdf](http://bfuels.nrel.colostate.edu/beta/COMET-Planner_Report_Final.pdf).

\newpage

# View your estimated GHG emission reductions {.unlisted .unnumbered}

###  Definitions {.unlisted .unnumbered}

- **Carbon dioxide equivalent (CO2eq)** is a unit used to compare various greenhouse gases based on their relative global warming potential.

- **Total greenhouse gases (GHG)** are the sum of carbon dioxide, methane, and nitrous oxide in units of CO2eq. Estimates include those associated with soils and woody biomass, but do not include off-site emissions like those from transportation.

- **Emission reduction coefficients** were calculated by COMET-Farm, which uses USDA greenhouse gas inventory methods. More information on quantification methods can be found in the COMET-Planner Report.

### Table Notes {.unlisted .unnumbered}
- Counties are grouped by dominant MLRA.
- **Emission Reduction Calculation**: Area (Acres) × Emission Reduction Coefficient (ERC)
- Negative emission reductions indicate a loss of carbon or increased emissions of GHG.

```{r summary}

summary_df <- janitor::adorn_totals(params$summary, fill = "", name = "Totals")

kbl_summary <- kbl(summary_df,
  col.names = c(
    "MLRA",
    "County",
    "Unique Practice Implementations",
    "Total Acres",
    "Total GHG (MT CO2eq/yr)"
  ),
  caption = "Summary of Estimated Total Greenhouse Gas (GHG) Emission Reductions by County",
  align = "llrrr",
  format.args = list(big.mark = ","),
  escape = FALSE,
  booktabs = TRUE
) %>%
  kable_styling(position = "left", latex_options = "HOLD_position") %>%
  row_spec(row = 0, bold = TRUE) %>%
  column_spec(column = c(1, 3, 5), width = "1.4in") %>%
  column_spec(column = c(2, 4), width = "0.8in") %>%
  collapse_rows(columns = 1) %>%
  row_spec(dim(summary_df)[1], bold = TRUE)

kbl_summary
```

```{r table}

options(knitr.kable.NA = "Not estimated")

df <- janitor::adorn_totals(params$data, fill = "", name = "Totals")

kbl_all <- kbl(df,
  col.names = c(
    "MLRA",
    "County",
    "Class",
    "Practice",
    "Implementation",
    "Acres",
    "Carbon Dioxide",
    "Nitrous Oxide",
    "Methane",
    "Total GHG"
  ),
  caption = "Estimated Greenhouse Gas (GHG) Emission Reductions",
  align = "lllllrrrrr",
  format.args = list(big.mark = ","),
  escape = FALSE,
  booktabs = TRUE
) %>%
  add_header_above(c(" " = 6, "(Metric tonnes CO2eq per year)" = 4),
    italic = TRUE
  ) %>%
  kable_styling(
    full_width = TRUE,
    position = "left",
    latex_options = "HOLD_position"
  ) %>%
  row_spec(row = 0, bold = TRUE) %>%
  column_spec(column = c(1:2), width = "0.8in") %>%
  column_spec(column = c(3:5), width = "1in") %>%
  column_spec(column = c(6:10), width = "0.8in") %>%
  collapse_rows(columns = 1) %>%
  row_spec(dim(df)[1], bold = TRUE)

kbl_all
```

```{r plot, fig.align = "center", fig.height = 2, fig.pos = "H", dpi = 300, fig.cap = "Estimated Greenhouse Gas (GHG) Emission Reductions"}

params$plot
```

\newpage

# Understand your impact: greenhouse gas equivalencies {.unlisted .unnumbered}

The values shown here are your total estimated esmissions reductions converted into terms you are more likely familiar with. Assumptions and equations used to calculate these values are provided in the Environmental Protection Agency's (EPA) [Greenhouse Gases Equivalencies Calculator](https://www.epa.gov/energy/greenhouse-gases-equivalencies-calculator-calculations-and-references). Results may differ slightly from those returned by EPA's calculator due to rounding.

```{r get total GHG estimate}

totalGHG <- params$data %>%
  select(totalGHG) %>%
  as.vector() %>%
  sum()
```

\
**Your total estimated GHG emission reduction is: `r format(totalGHG, big.mark = ",")` metric tonnes CO2eq per year.**

<!-- increase row height -->
\renewcommand{\arraystretch}{1.8}

```{r ghg equivalencies}

sys.source(paste0(tempdir(), "/fct_ghgEq.R"), envir = knitr::knit_global())

type <- c("home", "gas", "smartphone", "waste", "trash", "light", "seedling", "forest", "conversion")

description <- c(
  "homes' electricity use for one year",
  "gallons of gas consumed",
  "number of smartphones charged",
  "tons of waste recycled instead of landfilled",
  "trash bags of waste recycled instead of landfilled",
  "incandescent lamps switched to LEDs",
  "tree seedlings grown for 10 years",
  "acres of US forests in one year",
  "acres of US forests preserved from conversion to cropland in one year"
)

value <- lapply(type, fct_ghgEq, CO2eq = totalGHG) %>% unlist()

df <- data.frame(value, description)

options(knitr.table.toprule = NULL, knitr.table.bottomrule = NULL)

kbl_equivalencies <- kbl(df,
  align = "rl",
  booktabs = TRUE,
  col.names = NULL
) %>%
  kable_styling(position = "left", latex_options = "HOLD_position") %>%
  pack_rows(
    index = c(
      "This is equivalent to CO2 emissions from:" = 3,
      "This is equivalent to GHG emissions avoided by:" = 3,
      "This is equivalent to carbon sequestered by:" = 3
    ),
    background = "#d9e8e1",
    color = "black"
  ) %>%
  column_spec(column = 1, width = "1in", bold = TRUE) %>%
  column_spec(column = 2, width = "5in") %>% 
  sub("\\\\toprule", "", .) %>%
  sub("\\\\bottomrule", "", .)

kbl_equivalencies
```
